22.12 segment, stream_segment, ssegment

Basic stream segmenter.

The segmenter muxer outputs streams to a number of separate files of nearly fixed duration. Output filename pattern can be set in a fashion similar to image2.

stream_segment is a variant of the muxer used to write to streaming output formats, i.e. which do not require global headers, and is recommended for outputting e.g. to MPEG transport stream segments. ssegment is a shorter alias for stream_segment.

Every segment starts with a keyframe of the selected reference stream, which is set through the ‘reference_stream’ option.

Note that if you want accurate splitting for a video file, you need to make the input key frames correspond to the exact splitting times expected by the segmenter, or the segment muxer will start the new segment with the key frame found next after the specified start time.

The segment muxer works best with a single constant frame rate video.

Optionally it can generate a list of the created segments, by setting the option segment_list. The list type is specified by the segment_list_type option.

The segment muxer supports the following options:

‘reference_stream specifier’
Set the reference stream, as specified by the string specifier. If specifier is set to auto, the reference is choosen automatically. Otherwise it must be a stream specifier (see the “Stream specifiers” chapter in the ffmpeg manual) which specifies the reference stream. The default value is “auto”.

‘segment_format format’
Override the inner container format, by default it is guessed by the filename extension.

‘segment_list name’
Generate also a listfile named name. If not specified no listfile is generated.

‘segment_list_flags flags’
Set flags affecting the segment list generation.

It currently supports the following flags:

cache
Allow caching (only affects M3U8 list files).

live
Allow live-friendly file generation.

Default value is cache.

‘segment_list_size size’
Update the list file so that it contains at most the last size segments. If 0 the list file will contain all the segments. Default value is 0.

‘segment_list type type’
Specify the format for the segment list file.

The following values are recognized:

‘flat’
Generate a flat list for the created segments, one segment per line.

‘csv, ext’
Generate a list for the created segments, one segment per line, each line matching the format (comma-separated values):

   
segment_filename,segment_start_time,segment_end_time
segment_filename is the name of the output file generated by the muxer according to the provided pattern. CSV escaping (according to RFC4180) is applied if required.

segment_start_time and segment_end_time specify the segment start and end time expressed in seconds.

A list file with the suffix ".csv" or ".ext" will auto-select this format.

ext is deprecated in favor or csv.

‘ffconcat’
Generate an ffconcat file for the created segments. The resulting file can be read using the FFmpeg concat demuxer.

A list file with the suffix ".ffcat" or ".ffconcat" will auto-select this format.

‘m3u8’
Generate an extended M3U8 file, version 3, compliant with http://tools.ietf.org/id/draft-pantos-http-live-streaming.

A list file with the suffix ".m3u8" will auto-select this format.

If not specified the type is guessed from the list file name suffix.

‘segment_time time’
Set segment duration to time, the value must be a duration specification. Default value is "2". See also the ‘segment_times’ option.

Note that splitting may not be accurate, unless you force the reference stream key-frames at the given time. See the introductory notice and the examples below.

‘segment_time_delta delta’
Specify the accuracy time when selecting the start time for a segment, expressed as a duration specification. Default value is "0".

When delta is specified a key-frame will start a new segment if its PTS satisfies the relation:

 	
PTS >= start_time - time_delta
This option is useful when splitting video content, which is always split at GOP boundaries, in case a key frame is found just before the specified split time.

In particular may be used in combination with the ‘ffmpeg’ option force_key_frames. The key frame times specified by force_key_frames may not be set accurately because of rounding issues, with the consequence that a key frame time may result set just before the specified time. For constant frame rate videos a value of 1/2*frame_rate should address the worst case mismatch between the specified time and the time set by force_key_frames.

‘segment_times times’
Specify a list of split points. times contains a list of comma separated duration specifications, in increasing order. See also the ‘segment_time’ option.

‘segment_frames frames’
Specify a list of split video frame numbers. frames contains a list of comma separated integer numbers, in increasing order.

This option specifies to start a new segment whenever a reference stream key frame is found and the sequential number (starting from 0) of the frame is greater or equal to the next value in the list.

‘segment_wrap limit’
Wrap around segment index once it reaches limit.

‘segment_start_number number’
Set the sequence number of the first segment. Defaults to 0.

‘reset_timestamps 1|0’
Reset timestamps at the begin of each segment, so that each segment will start with near-zero timestamps. It is meant to ease the playback of the generated segments. May not work with some combinations of muxers/codecs. It is set to 0 by default.
